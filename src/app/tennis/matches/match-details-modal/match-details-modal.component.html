<!-- MATCH DETAILS MODAL (Shell version) -->
<app-bb-modal-shell *ngIf="isOpen" title="Match details" modalClass="bb-modal--match-details" (closed)="close()">
    <!-- =================================================================================================
       REUSABLE TEMPLATES
  ================================================================================================== -->

    <!-- Players header (2-column card) used on most tabs -->
    <ng-template #playersHeader let-v="v">
        <div class="bb-players-2col">
            <!-- PLAYER 1 -->
            <div class="bb-player">
                <div class="bb-player-head">
                    <span class="bb-flag-wrap" *ngIf="flagIso2OrEmpty(v.p1.iso2) as iso" [title]="v.p1.countryName">
                        <span class="fi fi-{{ iso }} bb-flag-sm"></span>
                    </span>

                    <div class="bb-player-name">
                        {{ v.p1.name }}
                        <span *ngIf="v.p1.iso3">({{ v.p1.iso3 }})</span>
                        <span class="bb-meta" *ngIf="v.p1.rank">#{{ v.p1.rank }}</span>
                        <span class="bb-meta" *ngIf="v.p1.seed">({{ v.p1.seed }})</span>
                    </div>
                </div>

                <div class="bb-player-body">
                    <div class="bb-avatar">
                        <img [src]="playerAvatarUrlById(v.p1.playerTPId)" (error)="onAvatarError($event)"
                            alt="Player avatar" loading="lazy" />
                    </div>

                    <div class="bb-kv">
                        <div class="bb-kv-row" *ngIf="v.p1.born">
                            <div class="bb-k">Born</div>
                            <div class="bb-v">{{ v.p1.born }}</div>
                        </div>

                        <div class="bb-kv-row" *ngIf="v.p1.plays">
                            <div class="bb-k">Plays</div>
                            <div class="bb-v">{{ v.p1.plays }}</div>
                        </div>

                        <div class="bb-kv-row" *ngIf="v.p1.height">
                            <div class="bb-k">Height</div>
                            <div class="bb-v">{{ v.p1.height }}</div>
                        </div>

                        <div class="bb-kv-row" *ngIf="v.p1.weight">
                            <div class="bb-k">Weight</div>
                            <div class="bb-v">{{ v.p1.weight }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PLAYER 2 -->
            <div class="bb-player">
                <div class="bb-player-head">
                    <span class="bb-flag-wrap" *ngIf="flagIso2OrEmpty(v.p2.iso2) as iso" [title]="v.p2.countryName">
                        <span class="fi fi-{{ iso }} bb-flag-sm"></span>
                    </span>

                    <div class="bb-player-name">
                        {{ v.p2.name }}
                        <span *ngIf="v.p2.iso3">({{ v.p2.iso3 }})</span>
                        <span class="bb-meta" *ngIf="v.p2.rank">#{{ v.p2.rank }}</span>
                        <span class="bb-meta" *ngIf="v.p2.seed">({{ v.p2.seed }})</span>
                    </div>
                </div>

                <div class="bb-player-body">
                    <div class="bb-avatar">
                        <img [src]="playerAvatarUrlById(v.p2.playerTPId)" (error)="onAvatarError($event)"
                            alt="Player avatar" loading="lazy" />
                    </div>

                    <div class="bb-kv">
                        <div class="bb-kv-row" *ngIf="v.p2.born">
                            <div class="bb-k">Born</div>
                            <div class="bb-v">{{ v.p2.born }}</div>
                        </div>

                        <div class="bb-kv-row" *ngIf="v.p2.plays">
                            <div class="bb-k">Plays</div>
                            <div class="bb-v">{{ v.p2.plays }}</div>
                        </div>

                        <div class="bb-kv-row" *ngIf="v.p2.height">
                            <div class="bb-k">Height</div>
                            <div class="bb-v">{{ v.p2.height }}</div>
                        </div>

                        <div class="bb-kv-row" *ngIf="v.p2.weight">
                            <div class="bb-k">Weight</div>
                            <div class="bb-v">{{ v.p2.weight }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ng-template>

    <!-- TrueSkill / chart selectors -->
    <ng-template #tsControls>
        <div class="bb-ts-controls">
            <div class="bb-ts-group">
                <div class="bb-ts-group-title">Granularity</div>

                <label class="bb-radio-pill">
                    <input type="radio" name="RatingMode" [value]="'M'" [(ngModel)]="RatingMode"
                        (ngModelChange)="onTsSelectorsChanged()" />
                    <span>Match</span>
                </label>

                <label class="bb-radio-pill">
                    <input type="radio" name="RatingMode" [value]="'SM'" [(ngModel)]="RatingMode"
                        (ngModelChange)="onTsSelectorsChanged()" />
                    <span>Set Match</span>
                </label>

                <label class="bb-radio-pill">
                    <input type="radio" name="RatingMode" [value]="'GSM'" [(ngModel)]="RatingMode"
                        (ngModelChange)="onTsSelectorsChanged()" />
                    <span>Game Set Match</span>
                </label>
            </div>

            <div class="bb-ts-group">
                <div class="bb-ts-group-title">Surface</div>

                <label class="bb-radio-pill">
                    <input type="radio" name="SurfaceScope" [value]="'ALL'" [(ngModel)]="SurfaceScope"
                        (ngModelChange)="onTsSelectorsChanged()" />
                    <span>All Surfaces</span>
                </label>

                <label class="bb-radio-pill">
                    <input type="radio" name="SurfaceScope" [value]="'S1'" [(ngModel)]="SurfaceScope"
                        (ngModelChange)="onTsSelectorsChanged()" />
                    <span>Carpet<span class="bb-hint" *ngIf="isCurrentSurface('S1')">(current)</span></span>
                </label>

                <label class="bb-radio-pill">
                    <input type="radio" name="SurfaceScope" [value]="'S2'" [(ngModel)]="SurfaceScope"
                        (ngModelChange)="onTsSelectorsChanged()" />
                    <span>Clay<span class="bb-hint" *ngIf="isCurrentSurface('S2')">(current)</span></span>
                </label>

                <label class="bb-radio-pill">
                    <input type="radio" name="SurfaceScope" [value]="'S3'" [(ngModel)]="SurfaceScope"
                        (ngModelChange)="onTsSelectorsChanged()" />
                    <span>Grass<span class="bb-hint" *ngIf="isCurrentSurface('S3')">(current)</span></span>
                </label>

                <label class="bb-radio-pill">
                    <input type="radio" name="SurfaceScope" [value]="'S4'" [(ngModel)]="SurfaceScope"
                        (ngModelChange)="onTsSelectorsChanged()" />
                    <span>Hard<span class="bb-hint" *ngIf="isCurrentSurface('S4')">(current)</span></span>
                </label>
            </div>
        </div>
    </ng-template>

    <!-- Pinned tooltip summary -->
    <ng-template #pinnedTooltipSummary let-tip="tip">
        <div class="bb-chart-tooltip bb-tooltip-summary">
            <div class="bb-summary-date">{{ tip.dateLabel }}</div>

            <div class="bb-summary-player bb-summary-p1">
                <span class="bb-dot bb-dot-red"></span>
                <span class="bb-summary-name">{{ tip.p1Label }}</span>
                <span class="bb-summary-metric"><b>μ</b> {{ tip.mu1 | number:'1.2-2' }}</span>
                <span class="bb-summary-metric"><b>σ</b> {{ tip.sd1 | number:'1.2-2' }}</span>
                <span class="bb-summary-metric"><b>WP</b> {{ tip.wp1 * 100 | number:'1.1-1' }}%</span>
            </div>

            <div class="bb-summary-player bb-summary-p2">
                <span class="bb-dot bb-dot-blue"></span>
                <span class="bb-summary-name">{{ tip.p2Label }}</span>
                <span class="bb-summary-metric"><b>μ</b> {{ tip.mu2 | number:'1.2-2' }}</span>
                <span class="bb-summary-metric"><b>σ</b> {{ tip.sd2 | number:'1.2-2' }}</span>
                <span class="bb-summary-metric"><b>WP</b> {{ tip.wp2 * 100 | number:'1.1-1' }}%</span>
            </div>
        </div>
    </ng-template>

    <!-- Hover tooltip -->
    <ng-template #hoverTooltipCard let-tip="tip">
        <div class="bb-chart-tooltip" [class.bb-tooltip-show]="true" [style.left.px]="tip.leftPx"
            [style.top.px]="tip.topPx">
            <div class="bb-chart-tooltip-title">{{ tip.dateLabel }}</div>

            <div class="bb-tt-grid">
                <div class="bb-tt-col">
                    <div class="bb-tt-player">
                        <span class="bb-dot bb-dot-red"></span>
                        <span class="bb-tt-player-name">{{ tip.p1Label }}</span>
                    </div>

                    <div class="bb-tt-metrics">
                        <div class="bb-tt-row">
                            <span class="bb-tt-k">Mean</span>
                            <span class="bb-tt-v"><b>μ {{ tip.mu1 | number:'1.2-2' }}</b></span>
                        </div>
                        <div class="bb-tt-row">
                            <span class="bb-tt-k">SD</span>
                            <span class="bb-tt-v">σ {{ tip.sd1 | number:'1.2-2' }}</span>
                        </div>
                        <div class="bb-tt-row">
                            <span class="bb-tt-k">WP</span>
                            <span class="bb-tt-v">{{ (tip.wp1 * 100) | number:'1.1-1' }}%</span>
                        </div>
                    </div>
                </div>

                <div class="bb-tt-col">
                    <div class="bb-tt-player">
                        <span class="bb-dot bb-dot-blue"></span>
                        <span class="bb-tt-player-name">{{ tip.p2Label }}</span>
                    </div>

                    <div class="bb-tt-metrics">
                        <div class="bb-tt-row">
                            <span class="bb-tt-k">Mean</span>
                            <span class="bb-tt-v"><b>μ {{ tip.mu2 | number:'1.2-2' }}</b></span>
                        </div>
                        <div class="bb-tt-row">
                            <span class="bb-tt-k">SD</span>
                            <span class="bb-tt-v">σ {{ tip.sd2 | number:'1.2-2' }}</span>
                        </div>
                        <div class="bb-tt-row">
                            <span class="bb-tt-k">WP</span>
                            <span class="bb-tt-v">{{ (tip.wp2 * 100) | number:'1.1-1' }}%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ng-template>

    <!-- TrueSkill snapshot -->
    <ng-template #tsSnapshot let-v="v">
        <div class="bb-ts-snapshot">
            <div class="bb-ts-snapshot-title">TrueSkill snapshot (selected mode/surface)</div>

            <div class="bb-compare bb-compare-ts">
                <div class="bb-comp-row">
                    <div class="bb-comp-left">{{ tsNum(tsMean('p1')) }}</div>
                    <div class="bb-comp-mid">TS Mean</div>
                    <div class="bb-comp-right">{{ tsNum(tsMean('p2')) }}</div>
                </div>

                <div class="bb-comp-row">
                    <div class="bb-comp-left">{{ tsNum(tsSd('p1')) }}</div>
                    <div class="bb-comp-mid">TS SD</div>
                    <div class="bb-comp-right">{{ tsNum(tsSd('p2')) }}</div>
                </div>

                <div class="bb-comp-row">
                    <div class="bb-comp-left">{{ wpPct(tsWp('p1')) }}</div>
                    <div class="bb-comp-mid">Win Probability</div>
                    <div class="bb-comp-right">{{ wpPct(tsWp('p2')) }}</div>
                </div>
            </div>
        </div>
    </ng-template>

    <!-- =================================================================================================
       HEADER LINE (subtitle area in shell)
       - We'll render the tournament meta line at the top of the content.
       - Later we can move this into shell "subtitle" input if we want.
  ================================================================================================== -->

    <div class="bb-header-line" *ngIf="vm as v">
        <span class="bb-pill bb-pill--title">
            <span class="bb-flag-wrap" *ngIf="flagIso2OrEmpty(v.header.iso2) as iso"
                [title]="v.header.countryName || 'World'">
                <span class="fi fi-{{ iso }} bb-flag-sm"></span>
            </span>

            {{ tourTypeLabel(raw) }}
            {{ v.header.name }}<span *ngIf="v.header.iso3"> ({{ v.header.iso3 }})</span>
        </span>

        <span class="bb-pill">
            {{ tourTypeLabel(raw) }}
            {{ v.header.name }}<span *ngIf="v.header.iso3"> ({{ v.header.iso3 }})</span>
        </span>

        <span class="bb-pill">{{ v.header.round }}</span>
        <span class="bb-pill">{{ v.header.surface }}</span>
        <span class="bb-pill">{{ v.header.dateText }}</span>

        <span class="bb-pill" *ngIf="v.header.prizeText !== '—'">Prize: {{ v.header.prizeText }}</span>

        <span class="bb-pill bb-pill-strength" *ngIf="tournamentStrengthTs(raw) as ts">
            Tournament strength:
            <span class="strength-cell" [title]="'TS: ' + ts.toFixed(2)">
                <span class="stars">
                    <span *ngFor="let s of stars" class="star" [ngClass]="starClass(s, tsToStars(ts))"></span>
                </span>
            </span>
        </span>
    </div>

    <!-- =================================================================================================
       TABS
  ================================================================================================== -->

    <div class="bb-tabs">
        <button class="bb-tab" [class.active]="activeTab==='overview'"
            (click)="onTabClick('overview')">Overview</button>
        <button class="bb-tab" [class.active]="activeTab==='tsBreakdown'" (click)="onTabClick('tsBreakdown')">TS
            Breakdown</button>
        <button class="bb-tab" [class.active]="activeTab==='wpBreakdown'" (click)="onTabClick('wpBreakdown')">WP
            Breakdown</button>
        <button class="bb-tab" [class.active]="activeTab==='performance'"
            (click)="setTab('performance')">Performance</button>
        <button class="bb-tab" [class.active]="activeTab==='form'" (click)="setTab('form')">Form</button>
        <button class="bb-tab" [class.active]="activeTab==='roleStats'" (click)="setTab('roleStats')">Role
            Stats</button>
        <button class="bb-tab" [class.active]="activeTab==='odds'" (click)="setTab('odds')">Odds</button>
        <button class="bb-tab" [class.active]="activeTab==='h2h'" (click)="setTab('h2h')">H2H</button>
    </div>

    <!-- =================================================================================================
       BODY (loading / error / content)
  ================================================================================================== -->

    <div class="bb-body">
        <div class="bb-loading" *ngIf="loading">Loading…</div>

        <!-- LOCKED / ERROR state (single block, no duplicates) -->
        <div class="bb-error" *ngIf="!loading && error">
            <div class="bb-error-title">{{ isLocked ? 'Details locked' : 'Could not load match details' }}</div>
            <div class="bb-error-msg">{{ error }}</div>

            <div class="bb-actions" *ngIf="isLocked; else genericErr">
                <button class="bb-btn" (click)="close()">Close</button>

                <ng-container *ngIf="!isLoggedIn; else loggedInLocked">
                    <button class="bb-btn" (click)="openLogin()">Login</button>
                    <button class="bb-btn" (click)="openRegister()">Register</button>
                </ng-container>

                <ng-template #loggedInLocked>
                    <button class="bb-btn" (click)="openUpgrade()">Unlock details</button>
                </ng-template>
            </div>

            <ng-template #genericErr>
                <button class="bb-btn" (click)="load()">Retry</button>
            </ng-template>
        </div>

        <!-- Main content -->
        <ng-container *ngIf="!loading && !error && vm as v">
            <!-- OVERVIEW -->
            <section *ngIf="activeTab==='overview'" class="bb-panel">
                <ng-container *ngTemplateOutlet="playersHeader; context: { v: v }"></ng-container>

                <div class="bb-result-row" *ngIf="v.finished">
                    <div class="bb-result">
                        <div class="bb-result-main">{{ v.scoreMain }}</div>
                        <div class="bb-result-sets">{{ v.scoreSets }}</div>
                    </div>
                </div>

                <div class="bb-compare">
                    <div class="bb-comp-row">
                        <div class="bb-comp-left">
                            <span class="strength-cell" [title]="p1StrengthTooltip(raw)">
                                <span class="stars">
                                    <span *ngFor="let s of stars" class="star"
                                        [ngClass]="starClass(s, p1StrengthStars(raw))"></span>
                                </span>
                            </span>
                        </div>
                        <div class="bb-comp-mid">Strength</div>
                        <div class="bb-comp-right">
                            <span class="strength-cell" [title]="p2StrengthTooltip(raw)">
                                <span class="stars">
                                    <span *ngFor="let s of stars" class="star"
                                        [ngClass]="starClass(s, p2StrengthStars(raw))"></span>
                                </span>
                            </span>
                        </div>
                    </div>

                    <div class="bb-comp-row">
                        <div class="bb-comp-left">{{ nnPct(v.p1.nnProb) }}</div>
                        <div class="bb-comp-mid">Win Probability</div>
                        <div class="bb-comp-right">{{ nnPct(v.p2.nnProb) }}</div>
                    </div>

                    <div class="bb-comp-row">
                        <div class="bb-comp-left">{{ oddsText(v.p1.odds) }}</div>
                        <div class="bb-comp-mid">Odds</div>
                        <div class="bb-comp-right">{{ oddsText(v.p2.odds) }}</div>
                    </div>

                    <div class="bb-comp-row">
                        <div class="bb-comp-left">{{ edgeText(v.edgeP1) }}</div>
                        <div class="bb-comp-mid">Edge</div>
                        <div class="bb-comp-right">{{ edgeText(v.edgeP2) }}</div>
                    </div>

                    <div class="bb-comp-row">
                        <div class="bb-comp-left">
                            <span *ngIf="v.betSide === 'p1'" class="bb-bet-icon" title="Value bet">✓</span>
                        </div>
                        <div class="bb-comp-mid">Who2Bet</div>
                        <div class="bb-comp-right">
                            <span *ngIf="v.betSide === 'p2'" class="bb-bet-icon" title="Value bet">✓</span>
                        </div>
                    </div>

                    <div class="bb-comp-row">
                        <div class="bb-comp-left">
                            <span *ngIf="v.pl !== undefined && v.pl > 0" class="bb-pl bb-pl-positive">+{{
                                v.pl.toFixed(2) }}</span>
                        </div>
                        <div class="bb-comp-mid">PL</div>
                        <div class="bb-comp-right">
                            <span *ngIf="v.pl !== undefined && v.pl < 0" class="bb-pl bb-pl-negative">{{ v.pl.toFixed(2)
                                }}</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TS BREAKDOWN -->
            <section *ngIf="activeTab==='tsBreakdown'" class="bb-panel">
                <ng-container *ngTemplateOutlet="playersHeader; context: { v: v }"></ng-container>
                <ng-container *ngTemplateOutlet="tsControls"></ng-container>
                <ng-container *ngTemplateOutlet="tsSnapshot; context: { v: v }"></ng-container>

                <ng-container *ngIf="pinnedTooltip as tip">
                    <ng-container *ngTemplateOutlet="pinnedTooltipSummary; context: { tip: tip }"></ng-container>
                </ng-container>

                <div *ngIf="tsBreakdownLoading" class="bb-loading">Loading TS history…</div>
                <div *ngIf="!tsBreakdownLoading && tsBreakdownError" class="bb-error">{{ tsBreakdownError }}</div>

                <ng-container *ngIf="!tsBreakdownLoading && !tsBreakdownError">
                    <ng-container *ngIf="getTsChartModel() as cm; else noTsChart">
                        <div class="bb-chart-wrap">
                            <svg [attr.viewBox]="'0 0 ' + chartWidth + ' ' + chartHeight"
                                style="width:100%; height:auto; display:block;"
                                (mousemove)="onTsChartMouseMove($event, cm)" (mouseleave)="onTsChartMouseLeave()">
                                <g *ngFor="let yt of cm.yTicks">
                                    <line [attr.x1]="chartPad" [attr.x2]="chartWidth-chartPad" [attr.y1]="yt.y"
                                        [attr.y2]="yt.y" stroke="rgba(255,255,255,0.08)"></line>
                                    <text [attr.x]="6" [attr.y]="yt.y+4" font-size="11" fill="rgba(255,255,255,0.65)">{{
                                        yt.label }}</text>
                                </g>

                                <g *ngFor="let xt of cm.xTicks">
                                    <line [attr.x1]="xt.x" [attr.x2]="xt.x" [attr.y1]="chartHeight-chartPad"
                                        [attr.y2]="chartHeight-chartPad+6" stroke="rgba(255,255,255,0.25)"></line>
                                    <text [attr.x]="xt.x" [attr.y]="chartHeight-6" text-anchor="middle" font-size="11"
                                        fill="rgba(255,255,255,0.65)">{{ xt.label }}</text>
                                </g>

                                <line [attr.x1]="chartPad" [attr.x2]="chartPad" [attr.y1]="chartPad"
                                    [attr.y2]="chartHeight-chartPad" stroke="rgba(255,255,255,0.25)"></line>
                                <line [attr.x1]="chartPad" [attr.x2]="chartWidth-chartPad"
                                    [attr.y1]="chartHeight-chartPad" [attr.y2]="chartHeight-chartPad"
                                    stroke="rgba(255,255,255,0.25)"></line>

                                <line *ngIf="cm.matchX !== null" [attr.x1]="cm.matchX" [attr.x2]="cm.matchX"
                                    [attr.y1]="chartPad" [attr.y2]="20 + chartHeight-chartPad"
                                    stroke="rgba(255,255,255,0.22)" stroke-dasharray="4 4"></line>

                                <g *ngIf="cm.matchX !== null">
                                    <text [attr.x]="cm.matchX" [attr.y]="20 + chartPad - 8" text-anchor="middle"
                                        font-size="14" fill="rgba(255,255,255,0.75)">
                                        Match date
                                    </text>
                                </g>

                                <path [attr.d]="cm.p1Path" fill="none" stroke="#ff4d4d" stroke-width="2.2"
                                    opacity="0.95"></path>
                                <path [attr.d]="cm.p2Path" fill="none" stroke="#4da3ff" stroke-width="2.2"
                                    opacity="0.95"></path>

                                <path *ngIf="cm.p1TrendPath" [attr.d]="cm.p1TrendPath" fill="none" stroke="#ff4d4d"
                                    stroke-width="1.8" opacity="0.55" stroke-dasharray="6 6"></path>
                                <path *ngIf="cm.p2TrendPath" [attr.d]="cm.p2TrendPath" fill="none" stroke="#4da3ff"
                                    stroke-width="1.8" opacity="0.55" stroke-dasharray="6 6"></path>

                                <g *ngIf="cm.hoverX !== null">
                                    <line [attr.x1]="cm.hoverX" [attr.x2]="cm.hoverX" [attr.y1]="chartPad"
                                        [attr.y2]="chartHeight-chartPad" stroke="rgba(255,255,255,0.20)"></line>
                                    <circle [attr.cx]="cm.hoverX" [attr.cy]="cm.hoverY1" r="4.5" fill="#ff4d4d"
                                        opacity="0.95"></circle>
                                    <circle [attr.cx]="cm.hoverX" [attr.cy]="cm.hoverY2" r="4.5" fill="#4da3ff"
                                        opacity="0.95"></circle>
                                </g>
                            </svg>
                        </div>
                    </ng-container>

                    <ng-template #noTsChart>
                        <div class="bb-error">Not enough points to draw chart.</div>
                    </ng-template>
                </ng-container>
            </section>

            <!-- WP BREAKDOWN -->
            <section *ngIf="activeTab==='wpBreakdown'" class="bb-panel">
                <ng-container *ngTemplateOutlet="playersHeader; context: { v: v }"></ng-container>
                <ng-container *ngTemplateOutlet="tsControls"></ng-container>
                <ng-container *ngTemplateOutlet="tsSnapshot; context: { v: v }"></ng-container>

                <ng-container *ngIf="pinnedTooltip as tip">
                    <ng-container *ngTemplateOutlet="pinnedTooltipSummary; context: { tip: tip }"></ng-container>
                </ng-container>

                <div *ngIf="tsBreakdownLoading" class="bb-loading">Loading TS history…</div>
                <div *ngIf="!tsBreakdownLoading && tsBreakdownError" class="bb-error">{{ tsBreakdownError }}</div>

                <ng-container *ngIf="!tsBreakdownLoading && !tsBreakdownError">
                    <ng-container *ngIf="getWpChartModel() as cm; else noWpChart">
                        <div class="bb-chart-wrap">
                            <svg [attr.viewBox]="'0 0 ' + chartWidth + ' ' + chartHeight"
                                style="width:100%; height:auto; display:block;"
                                (mousemove)="onWpChartMouseMove($event, cm)" (mouseleave)="onWpChartMouseLeave()">
                                <g *ngFor="let yt of cm.yTicks">
                                    <line [attr.x1]="chartPad" [attr.x2]="chartWidth-chartPad" [attr.y1]="yt.y"
                                        [attr.y2]="yt.y" stroke="rgba(255,255,255,0.08)"></line>
                                    <text [attr.x]="6" [attr.y]="yt.y+4" font-size="11" fill="rgba(255,255,255,0.65)">{{
                                        yt.label }}</text>
                                </g>

                                <g *ngFor="let xt of cm.xTicks">
                                    <line [attr.x1]="xt.x" [attr.x2]="xt.x" [attr.y1]="chartHeight-chartPad"
                                        [attr.y2]="chartHeight-chartPad+6" stroke="rgba(255,255,255,0.25)"></line>
                                    <text [attr.x]="xt.x" [attr.y]="chartHeight-6" text-anchor="middle" font-size="11"
                                        fill="rgba(255,255,255,0.65)">{{ xt.label }}</text>
                                </g>

                                <line [attr.x1]="chartPad" [attr.x2]="chartPad" [attr.y1]="chartPad"
                                    [attr.y2]="chartHeight-chartPad" stroke="rgba(255,255,255,0.25)"></line>
                                <line [attr.x1]="chartPad" [attr.x2]="chartWidth-chartPad"
                                    [attr.y1]="chartHeight-chartPad" [attr.y2]="chartHeight-chartPad"
                                    stroke="rgba(255,255,255,0.25)"></line>

                                <line *ngIf="cm.matchX !== null" [attr.x1]="cm.matchX" [attr.x2]="cm.matchX"
                                    [attr.y1]="chartPad" [attr.y2]="20 + chartHeight-chartPad"
                                    stroke="rgba(255,255,255,0.22)" stroke-dasharray="4 4"></line>

                                <g *ngIf="cm.matchX !== null">
                                    <text [attr.x]="cm.matchX" [attr.y]="20 + chartPad - 8" text-anchor="middle"
                                        font-size="14" fill="rgba(255,255,255,0.75)">
                                        Match date
                                    </text>
                                </g>

                                <path [attr.d]="cm.wp1Path" fill="none" stroke="#ff4d4d" stroke-width="2.2"
                                    opacity="0.95"></path>
                                <path *ngIf="cm.wp2Path" [attr.d]="cm.wp2Path" fill="none" stroke="#4da3ff"
                                    stroke-width="2.2" opacity="0.75"></path>

                                <g *ngIf="cm.hoverX !== null">
                                    <line [attr.x1]="cm.hoverX" [attr.x2]="cm.hoverX" [attr.y1]="chartPad"
                                        [attr.y2]="chartHeight-chartPad" stroke="rgba(255,255,255,0.20)"></line>
                                    <circle [attr.cx]="cm.hoverX" [attr.cy]="cm.hoverY1" r="4.5" fill="#ff4d4d"
                                        opacity="0.95"></circle>
                                    <circle *ngIf="cm.hoverY2 !== null" [attr.cx]="cm.hoverX" [attr.cy]="cm.hoverY2"
                                        r="4.5" fill="#4da3ff" opacity="0.85"></circle>
                                </g>
                            </svg>
                        </div>
                    </ng-container>

                    <ng-template #noWpChart>
                        <div class="bb-error">Not enough points to draw chart.</div>
                    </ng-template>
                </ng-container>
            </section>

            <!-- PERFORMANCE / FORM / ROLE / H2H / ODDS -->
            <!-- (ostatak tvojih sekcija ide 1:1, bez wrappera bb-shell/bb-card/bb-header jer to radi shell) -->

            <!-- ... ostavi sve dalje kako imaš; ja sam ti gore pokazao pattern i već smo maknuli dupli overlay ... -->
        </ng-container>
    </div>
</app-bb-modal-shell>