<app-bb-modal-shell
  title="Reset Password"
  subtitle="Postavi novu lozinku i potvrdi je."
  (closed)="closeAndGoToLogin()"
>
  <form [formGroup]="form" (ngSubmit)="onSubmit()" autocomplete="off" novalidate>
    <!-- PASSWORD -->
    <div class="form-row">
      <label for="password">New Password:</label>

      <div class="password-wrapper">
        <input
          [type]="showPassword ? 'text' : 'password'"
          id="password"
          formControlName="password"
          class="password-input"
          placeholder="New password"
          autocomplete="new-password"
          [class.invalid]="form.get('password')?.invalid && (form.get('password')?.touched || submitted)"
        />

        <button
          type="button"
          class="toggle-password"
          appAccessibleClick
          (accessibleClick)="showPassword = !showPassword"
          aria-label="Toggle password visibility"
        >
          <i class="bi" [ngClass]="showPassword ? 'bi-eye-slash' : 'bi-eye'"></i>
        </button>
      </div>

      <p
        class="error"
        *ngIf="form.get('password')?.hasError('required') && (form.get('password')?.touched || submitted)"
      >
        Required
      </p>
    </div>

    <!-- CONFIRM -->
    <div class="form-row">
      <label for="confirm">Confirm Password:</label>

      <div class="password-wrapper">
        <input
          [type]="showConfirm ? 'text' : 'password'"
          id="confirm"
          formControlName="confirm"
          class="password-input"
          placeholder="Confirm password"
          autocomplete="new-password"
          [class.invalid]="(form.touched || submitted) && !!form.errors?.['passwordsMismatch']"
        />

        <button
          type="button"
          class="toggle-password"
          appAccessibleClick
          (accessibleClick)="showConfirm = !showConfirm"
          aria-label="Toggle confirm password visibility"
        >
          <i class="bi" [ngClass]="showConfirm ? 'bi-eye-slash' : 'bi-eye'"></i>
        </button>
      </div>

      <p class="error" *ngIf="form.errors?.['passwordsMismatch'] && (form.touched || submitted)">
        Passwords do not match
      </p>
    </div>

    <!-- STATUS -->
    <div class="bb-alert bb-alert--success" *ngIf="successMessage">
      {{ successMessage }}
    </div>

    <div class="bb-alert bb-alert--error" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <div bbActions class="bb-actions">
      <button type="button" class="oauth-btn" (click)="closeAndGoToLogin()">Cancel</button>

      <button
        type="submit"
        class="oauth-btn oauth-btn-primary"
        [disabled]="form.invalid || loading"
      >
        {{ loading ? 'Resettingâ€¦' : 'Reset password' }}
      </button>
    </div>
  </form>
</app-bb-modal-shell>